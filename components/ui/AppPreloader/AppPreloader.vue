<template lang="pug">
  .preloader
    .preloader__bar#preloader
      svg(width='142', height='142', viewBox='0 0 142 142', fill='none', xmlns='http://www.w3.org/2000/svg' class='preloader__circle')
        path(d='M73.0226 0H69.0586V40.5122H73.0226V0Z', fill='url(#paint0_linear)')
        path(d='M60.5877 0.787677L56.6839 1.47583L63.7168 41.3723L67.6206 40.6841L60.5877 0.787677Z', fill='url(#paint1_linear)')
        path(d='M48.6245 3.63466L44.8995 4.99036L58.7547 43.0597L62.4797 41.704L48.6245 3.63466Z', fill='url(#paint2_linear)')
        path(d='M37.2527 8.5103L33.8198 10.4923L54.0759 45.5759L57.5088 43.5939L37.2527 8.5103Z', fill='url(#paint3_linear)')
        path(d='M26.8712 15.3369L23.8347 17.885L49.876 48.9174L52.9124 46.3693L26.8712 15.3369Z', fill='url(#paint4_linear)')
        path(d='M17.901 23.8967L15.3529 26.9331L46.3853 52.9744L48.9333 49.9379L17.901 23.8967Z', fill='url(#paint5_linear)')
        path(d='M10.494 33.804L8.51196 37.2368L43.5956 57.4929L45.5776 54.0601L10.494 33.804Z', fill='url(#paint6_linear)')
        path(d='M4.94407 44.8376L3.58838 48.5626L41.6577 62.4178L43.0134 58.6928L4.94407 44.8376Z', fill='url(#paint7_linear)')
        path(d='M1.4044 56.7179L0.716248 60.6217L40.6127 67.6546L41.3008 63.7509L1.4044 56.7179Z', fill='url(#paint8_linear)')
        path(d='M1.68359e-10 68.9646L0 72.9286L40.5122 72.9286L40.5122 68.9646L1.68359e-10 68.9646Z', fill='url(#paint9_linear)')
        path(d='M0.749408 81.3992L1.43756 85.303L41.334 78.2701L40.6459 74.3663L0.749408 81.3992Z', fill='url(#paint10_linear)')
        path(d='M3.62288 93.4142L4.97858 97.1392L43.0479 83.284L41.6922 79.559L3.62288 93.4142Z', fill='url(#paint11_linear)')
        path(d='M8.51805 104.804L10.5001 108.237L45.5837 87.9806L43.6017 84.5477L8.51805 104.804Z', fill='url(#paint12_linear)')
        path(d='M15.36 115.116L17.908 118.152L48.9404 92.1108L46.3923 89.0744L15.36 115.116Z', fill='url(#paint13_linear)')
        path(d='M23.9091 124.076L26.9455 126.624L52.9868 95.5918L49.9503 93.0437L23.9091 124.076Z', fill='url(#paint14_linear)')
        path(d='M33.7865 131.429L37.2193 133.411L57.4754 98.3278L54.0426 96.3458L33.7865 131.429Z', fill='url(#paint15_linear)')
        path(d='M44.826 136.993L48.551 138.349L62.4062 100.279L58.6812 98.9236L44.826 136.993Z', fill='url(#paint16_linear)')
        path(d='M56.7446 140.556L60.6483 141.244L67.6812 101.348L63.7775 100.66L56.7446 140.556Z', fill='url(#paint17_linear)')
        path(d='M68.977 142L72.941 142L72.941 101.488L68.977 101.488L68.977 142Z', fill='url(#paint18_linear)')
        path(d='M81.3583 141.187L85.2621 140.499L78.2292 100.602L74.3254 101.29L81.3583 141.187Z', fill='url(#paint19_linear)')
        path(d='M93.3636 138.352L97.0886 136.997L83.2334 98.9272L79.5085 100.283L93.3636 138.352Z', fill='url(#paint20_linear)')
        path(d='M104.74 133.452L108.173 131.47L87.9169 96.3866L84.484 98.3686L104.74 133.452Z', fill='url(#paint21_linear)')
        path(d='M115.105 126.64L118.142 124.092L92.1005 93.06L89.0641 95.6081L115.105 126.64Z', fill='url(#paint22_linear)')
        path(d='M124.076 118.101L126.624 115.064L95.5915 89.0228L93.0435 92.0593L124.076 118.101Z', fill='url(#paint23_linear)')
        path(d='M131.499 108.208L133.481 104.776L98.3973 84.5195L96.4153 87.9524L131.499 108.208Z', fill='url(#paint24_linear)')
        path(d='M137.044 97.15L138.399 93.425L100.33 79.5699L98.9744 83.2949L137.044 97.15Z', fill='url(#paint25_linear)')
        path(d='M140.619 85.2962L141.308 81.3925L101.411 74.3595L100.723 78.2633L140.619 85.2962Z', fill='url(#paint26_linear)')
        path(d='M142 73.0103L142 69.0463L101.488 69.0463L101.488 73.0103L142 73.0103Z', fill='url(#paint27_linear)')
        path(d='M141.226 60.6148L140.538 56.7111L100.642 63.744L101.33 67.6477L141.226 60.6148Z', fill='url(#paint28_linear)')
        path(d='M138.388 48.5736L137.032 44.8486L98.9628 58.7038L100.318 62.4288L138.388 48.5736Z', fill='url(#paint29_linear)')
        path(d='M133.489 37.2084L131.507 33.7755L96.4233 54.0316L98.4053 57.4645L133.489 37.2084Z', fill='url(#paint30_linear)')
        path(d='M126.663 26.8815L124.115 23.8451L93.0829 49.8863L95.631 52.9228L126.663 26.8815Z', fill='url(#paint31_linear)')
        path(d='M118.114 17.9015L115.078 15.3534L89.0364 46.3858L92.0729 48.9338L118.114 17.9015Z', fill='url(#paint32_linear)')
        path(d='M108.22 10.5329L104.788 8.5509L84.5314 43.6345L87.9643 45.6165L108.22 10.5329Z', fill='url(#paint33_linear)')
        path(d='M97.186 4.99412L93.461 3.63843L79.6058 41.7078L83.3308 43.0635L97.186 4.99412Z', fill='url(#paint34_linear)')
        path(d='M85.3092 1.41838L81.4055 0.730225L74.3725 40.6267L78.2763 41.3148L85.3092 1.41838Z', fill='url(#paint35_linear)')
        circle(cx='71.5', cy='71.5', r='62.5', fill='white')
        defs
          lineargradient#paint0_linear(x1='71.6809', y1='3.99309e-07', x2='61.8176', y2='2.31116', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint1_linear(x1='59.2664', y1='1.02059', x2='49.9542', y2='5.0089', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint2_linear(x1='47.3638', y1='4.09351', x2='38.8856', y2='9.63857', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint3_linear(x1='36.0908', y1='9.18114', x2='28.7047', y2='16.1143', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint4_linear(x1='25.8434', y1='16.1994', x2='19.7737', y2='24.3099', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint5_linear(x1='17.0386', y1='24.9244', x2='12.4688', y2='33.9653', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint6_linear(x1='9.82314', y1='34.9659', x2='6.89294', y2='44.6631', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint7_linear(x1='4.48522', y1='46.0984', x2='3.28376', y2='56.1574', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint8_linear(x1='1.17149', y1='58.0392', x2='1.73525', y2='68.1538', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint9_linear(x1='3.99421e-07', y1='70.3062', x2='2.31116', y2='80.1696', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint10_linear(x1='0.982322', y1='82.7205', x2='4.97063', y2='92.0327', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint11_linear(x1='4.08173', y1='94.6749', x2='9.62679', y2='103.153', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint12_linear(x1='9.18889', y1='105.966', x2='16.122', y2='113.352', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint13_linear(x1='16.2224', y1='116.143', x2='24.3329', y2='122.213', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint14_linear(x1='24.9368', y1='124.938', x2='33.9777', y2='129.508', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint15_linear(x1='34.9483', y1='132.1', x2='44.6456', y2='135.03', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint16_linear(x1='46.0868', y1='137.452', x2='56.1458', y2='138.653', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint17_linear(x1='58.0658', y1='140.789', x2='68.1804', y2='140.225', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint18_linear(x1='70.3186', y1='142', x2='80.182', y2='139.689', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint19_linear(x1='82.6796', y1='140.954', x2='91.9918', y2='136.966', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint20_linear(x1='94.6244', y1='137.893', x2='103.103', y2='132.348', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint21_linear(x1='105.902', y1='132.781', x2='113.288', y2='125.848', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint22_linear(x1='116.133', y1='125.778', x2='122.203', y2='117.668', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint23_linear(x1='124.938', y1='117.073', x2='129.508', y2='108.032', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint24_linear(x1='132.17', y1='107.047', x2='135.1', y2='97.3494', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint25_linear(x1='137.503', y1='95.8893', x2='138.704', y2='85.8303', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint26_linear(x1='140.852', y1='83.9749', x2='140.289', y2='73.8603', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint27_linear(x1='142', y1='71.6686', x2='139.689', y2='61.8053', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint28_linear(x1='140.994', y1='59.2935', x2='137.005', y2='49.9814', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint29_linear(x1='137.929', y1='47.3129', x2='132.384', y2='38.8347', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint30_linear(x1='132.818', y1='36.0465', x2='125.885', y2='28.6604', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint31_linear(x1='125.801', y1='25.8538', x2='117.69', y2='19.7841', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint32_linear(x1='117.086', y1='17.039', x2='108.045', y2='12.4692', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint33_linear(x1='107.058', y1='9.86208', x2='97.3613', y2='6.93188', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint34_linear(x1='95.9252', y1='4.53527', x2='85.8662', y2='3.33381', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
          lineargradient#paint35_linear(x1='83.9879', y1='1.18546', x2='73.8733', y2='1.74922', gradientUnits='userSpaceOnUse')
            stop(stop-color='#FF3F00')
            stop(offset='1', stop-color='#FF0047')
      span.preloader__percent 0%
</template>

<script>
  import { gsap, CSSPlugin } from 'gsap/all';
  gsap.registerPlugin(CSSPlugin);

  export default {
    name: 'AppPreloader',
    mounted() {
      let index = 0;
      const bar = document.querySelector('.preloader__bar');
      const dashes = Array.from(document.querySelectorAll('.preloader__circle path')).reverse();
      const overlay = document.querySelector('.preloader');
      const perfData = window.performance.timing;
      const EstimatedTime = -(perfData.loadEventEnd - perfData.navigationStart);
      const time = parseInt((EstimatedTime / 1000) % 60) * 100;

      const PercentageID = document.querySelector('.preloader__percent');
      const start = 0;
      const end = 100;
      const duration = time;
      animateValue(PercentageID, start, end, duration);

      function animateValue(id, start, end, duration) {
        const range = end - start;
        let current = start;
        const increment = end > start ? 1 : -1;
        const stepTime = Math.abs(Math.floor(duration / range));
        const obj = id;

        const timer = setInterval(function() {
          dashes[index].style.animation = 'fadeDash 1.2s 1';
          index = Math.ceil((35 / 100) * current);
          current += increment;
          obj.textContent = current + '%';
          if (current >= end) {
            clearInterval(timer);
          }
        }, stepTime);
      }

      setTimeout(function() {
        gsap.to(bar, 0, {
          autoAlpha: 0,
          ease: 'power1.out'
        });
        gsap.to(overlay, 0.7, {
          autoAlpha: 0,
          ease: 'power1.out'
        });
      }, time);
    }
  };
</script>

<style lang="sass">
  @import "AppPreloader"
</style>
